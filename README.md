# khushalHelloWorldGrpcStarter

A simple Hello World gRPC service implementation using Python and Bazel.

## Project Structure

```
.
├── protos/              # Protocol buffer definitions and BUILD file
├── src/
│   ├── client/         # (empty or client implementation)
│   └── server/         # gRPC server implementation and BUILD file
├── WORKSPACE            # Bazel workspace file
├── requirements.in      # Top-level Python dependencies (source of truth)
├── requirements_lock.txt# Locked Python dependencies (generated by pip-compile)
├── README.md            # This file
└── .bazelversion        # (optional) Bazel version pin
```

## Prerequisites

- Python 3.11 or later
- Bazel 8.0 or later
- gRPC tools

## Building

To build the project:

```bash
bazel build //...
```

## Running

(Server and client run instructions will be added once implemented)

## License

MIT License

# Bazel + Python gRPC/Protobuf Build Attempts (Comprehensive Context Log)

## What We Tried (Chronological)

### 1. **Modern, Stable Versions (rules_proto 7.x, com_google_protobuf 25.x, rules_python 1.0.0, Bazel 6+)**
- Used latest rules_proto, com_google_protobuf, rules_python, and pip_parse.
- Used pip_parse with requirements_lock.txt generated by pip-compile.
- **Result:** Bazel required Java toolchains (even for Python-only projects). Errors about missing @rules_java and @compatibility_proxy.

### 2. **Added rules_java 7.6.0**
- Added to WORKSPACE with correct sha256 and strip_prefix.
- **Result:** Bazel failed due to missing java/proto directory and BUILD file in rules_java. Still could not resolve Java toolchain.

### 3. **Tried rules_proto_grpc 4.2.0**
- Switched to community-maintained rules_proto_grpc.
- Updated BUILD files to use proto_grpc_python_library.
- **Result:** The expected rule was not present in the version used; build failed.

### 4. **Tried pip_install, pip_parse, compile_pip_requirements**
- Used pip_install and pip_parse for Python dependencies.
- Used requirements.in and pip-compile to generate requirements_lock.txt.
- **Result:** Bazel could not find @pip//:grpcio or @pip//:protobuf targets, or failed to generate them.

### 5. **Tried various rules_proto and rules_python versions**
- Downgraded rules_proto to 5.3.0, 4.2.0, and rules_python to 0.24.0, 0.29.0.
- Adjusted WORKSPACE and BUILD files for each version.
- **Result:** Either failed to fetch rules_proto (404s), or failed with missing .bzl/BUILD files, or pip targets not generated.

### 6. **Tried bzlmod (Bazel module system)**
- Considered switching to bzlmod for dependency management.
- **Result:** Not attempted in this repo, but noted as a possible future solution.

### 7. **Manual requirements.txt, requirements.in, requirements_lock.txt**
- Used requirements.in and pip-compile to generate requirements_lock.txt.
- Used pip_parse and pip_install with both files.
- **Result:** Bazel sometimes failed to generate pip targets, or failed to resolve dependencies.

### 8. **Explicitly added com_google_protobuf and toolchain registration**
- Added com_google_protobuf http_archive with correct sha256 and strip_prefix.
- Registered toolchains as per rules_proto documentation.
- **Result:** Still required Java toolchains, leading to errors.

### 9. **Tried different combinations and orders of http_archive, load, and macro calls**
- Moved load and http_archive statements to the top of WORKSPACE.
- Tried different orders for py_repositories, rules_proto, rules_python, etc.
- **Result:** Did not resolve toolchain or dependency errors.

### 10. **General Troubleshooting**
- Used `bazel clean --expunge` after every major change.
- Checked for correct sha256 for every archive.
- Used curl + shasum to verify downloads.
- Consulted official docs, GitHub issues, and community forums.

## Key Lessons
- **Recent Bazel/protobuf rules require Java toolchains by default, even for Python-only projects.**
- **rules_proto_grpc** is easier for gRPC projects, but rule names and exports change between versions.
- **Stable, older versions** of rules_proto and protobuf are the most reliable for Python-only Bazel projects.
- **pip_parse and pip_install** can be tricky; requirements_lock.txt must be generated with pip-compile for best results.
- **Order of repository and macro setup in WORKSPACE matters.**
- **Document your versions and errors!**

---

_This log is here to help future attempts and save time troubleshooting Bazel + Python + gRPC setups. If you try something new, add it here!_

## Managing Python Dependencies

This project uses a modern, reproducible Python dependency workflow:

- **`requirements.in`**: List your top-level Python dependencies here.
- **`requirements_lock.txt`**: This file is generated and pinned using `pip-compile` from the `pip-tools` package.

### How to generate `requirements_lock.txt`

1. **Install pip-tools** (if not already installed):
   ```sh
   python3 -m pip install --user pip-tools
   ```
   If you do not have `pip3` or `pip` installed, you may need to install Python 3 and pip first. On macOS, you can use Homebrew:
   ```sh
   brew install python3
   ```
   On Ubuntu/Debian:
   ```sh
   sudo apt-get install python3 python3-pip
   ```

2. **Generate the lock file:**
   ```sh
   /Users/khushal/Library/Python/3.9/bin/pip-compile requirements.in --output-file requirements_lock.txt
   ```
   (Replace the path with the location of `pip-compile` if different on your system. You can find it with `which pip-compile`.)

3. **Commit both `requirements.in` and `requirements_lock.txt` to version control.**

--- 